<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/logo-light.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#4FC1E9" />
    
    <!-- Logo che pu√≤ essere utilizzato dall'applicazione -->
    <link rel="preload" as="image" href="%PUBLIC_URL%/logo-light.svg" />
    
    <meta
      name="description"
      content="Salus - Applicazione per il monitoraggio della salute e del benessere"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Salus - Monitora la tua salute</title>
    
    <!-- Icone Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    
    <!-- Redirect in caso di errore 404 per refresh -->
    <script>
      // Script per gestire il refresh della pagina con routing client-side
      (function() {
        // Se siamo su Vercel o simili, in caso di refresh,
        // reindirizza alla root e mantieni il path come hash
        if (
          typeof window !== "undefined" &&
          window.location.pathname !== "/" &&
          !window.location.pathname.match(/\.(css|js|png|jpg|jpeg|svg|ico|json)$/)
        ) {
          // Salva il path corrente come hash
          const newPath = "/#" + window.location.pathname;
          window.location.replace(newPath);
        }
      })();
    </script>
    
    <!-- Script di correzione CORS - Viene eseguito prima di ogni altro script -->
    <script>
      // Override del metodo fetch per correggere i problemi di CORS e percorsi API
      const originalFetch = window.fetch;
      window.fetch = function(url, options = {}) {
        // Quando inizializziamo il fetch, annotiamo l'ora per poter misurare quanto tempo richiede
        const startTime = new Date().getTime();
        
        // Crea nuove opzioni ottimizzate per evitare problemi CORS
        // Impostiamo mode su 'cors' e non su 'no-cors' perch√© quest'ultimo limita le informazioni che possiamo ricevere
        const newOptions = {
          ...options,
          mode: 'cors',
          // Non impostiamo credentials a 'include' perch√© pu√≤ causare problemi con CORS
          // quando il server non √® configurato per accettarle
          credentials: 'same-origin',
          headers: {
            ...(options.headers || {}),
            'Accept': 'application/json, text/plain, */*',
            'Content-Type': options.body ? 'application/json' : (options.headers?.['Content-Type'] || 'text/plain')
          }
        };
        
        // Se l'URL √® una stringa, controlliamo se dobbiamo correggerlo
        if (typeof url === 'string') {
          // Log per debug solo per richieste di autenticazione/registrazione
          if (url.includes('/auth/') || url.includes('/api/auth/')) {
            console.log(`üîÑ Fetch originale: ${url}`);
            console.log(`üîÑ Opzioni: ${JSON.stringify(newOptions, null, 2)}`);
          }
          
          // Correggi URL per backend onrender.com
          if (url.includes('salus-backend.onrender.com')) {
            // Normalizza i percorsi API prima di inviare la richiesta
            if (!url.includes('/api/') && !url.includes('/status')) {
              // Inserisci '/api/' nel percorso se manca
              const parts = url.split('salus-backend.onrender.com/');
              if (parts.length > 1 && !parts[1].startsWith('api/')) {
                const correctedUrl = `${parts[0]}salus-backend.onrender.com/api/${parts[1]}`;
                console.log(`üõ†Ô∏è URL corretto: ${url} ‚Üí ${correctedUrl}`);
                url = correctedUrl;
              }
            }
          }
        }
        
        // Esegui il fetch con le nuove opzioni e l'URL corretto
        return originalFetch.call(this, url, newOptions)
          .then(response => {
            // Log del tempo di risposta
            const endTime = new Date().getTime();
            if (typeof url === 'string' && (url.includes('/auth/') || url.includes('/api/auth/'))) {
              console.log(`‚úÖ Risposta da ${url} in ${endTime - startTime}ms: ${response.status} ${response.statusText}`);
            }
            
            // Controlla se la risposta √® riuscita
            if (!response.ok && response.status !== 204) {
              // Per errori CORS, aggiunge informazioni utili al messaggio di errore
              if (response.status === 0 || response.type === 'opaqueredirect') {
                console.error(`‚ùå Probabile errore CORS su ${url}`);
                throw new Error(`Errore CORS: impossibile accedere a ${url}`);
              }
            }
            
            return response;
          })
          .catch(error => {
            // Log degli errori di rete
            console.error(`‚ùå Errore fetch per ${url}:`, error.message);
            throw error;
          });
      };
      
      // Registra quando il documento √® completamente caricato
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Documento caricato, proxy fetch installato per correggere problemi CORS');
      });
    </script>
    
    <style>
      /* Stili di base - per evitare FOUC */
      body {
        margin: 0;
        padding: 0;
        font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background-color: #f8f9fa;
        color: #333;
      }
      
      code {
        font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;
      }
      
      #root {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      /* Preloader per migliorare l'UX durante il caricamento */
      .app-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #f8f9fa;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 9999;
      }
      
      .loader-logo {
        width: 80px;
        height: 80px;
        margin-bottom: 20px;
        animation: pulse 1.5s infinite;
      }
      
      .loader-text {
        font-size: 18px;
        color: #4A90E2;
        margin-top: 10px;
      }
      
      @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
        100% { transform: scale(1); opacity: 1; }
      }
      
      /* Modalit√† dark */
      body.dark-mode {
        background-color: #121212;
        color: #e0e0e0;
      }
      
      body.dark-mode .app-loader {
        background-color: #121212;
      }
    </style>
  </head>
  <body>
    <noscript>√à necessario abilitare JavaScript per utilizzare questa app.</noscript>
    <div id="root"></div>
  </body>
</html> 